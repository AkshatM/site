---
import type { MarkdownHeading } from 'astro'
import { generateToc } from '@/utils'

import TOCHeading from './TOCHeading.astro'

interface Props {
	headings: MarkdownHeading[]
}

const { headings } = Astro.props

const toc = generateToc(headings)
---

<!-- Mobile TOC - Collapsible -->
<details class='lg:hidden mb-8 border border-border rounded-lg' id='mobile-toc'>
	<summary class='flex items-center justify-between px-4 py-3 cursor-pointer text-sm font-semibold uppercase tracking-[0.1em] text-muted-foreground hover:text-foreground transition-colors select-none'>
		<span>Table of Contents</span>
		<svg
			class='w-4 h-4 transition-transform duration-200 toc-chevron'
			fill='none'
			stroke='currentColor'
			viewBox='0 0 24 24'
			aria-hidden='true'
		>
			<path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/>
		</svg>
	</summary>
	<nav class='px-4 pb-4' aria-label='Table of contents'>
		<ul class='text-foreground'>
			{toc.map((heading) => <TOCHeading heading={heading} />)}
		</ul>
	</nav>
</details>

<style>
	details[open] .toc-chevron {
		transform: rotate(180deg);
	}
</style>

<!-- Desktop TOC - Sticky sidebar -->
<aside class='sticky top-20 order-2 -me-28 hidden basis-60 lg:flex lg:flex-col' aria-label='Table of contents'>
	<h2 class='font-semibold text-md uppercase tracking-[0.1em] text-muted-foreground'>Table of Contents</h2>
	<nav class='mt-3'>
		<ul class='text-foreground'>
			{toc.map((heading) => <TOCHeading heading={heading} />)}
		</ul>
	</nav>
</aside>
